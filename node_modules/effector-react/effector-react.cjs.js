function e(e,t){var r,s,o,a;let c,u;if(effector.is.store(e))u=e;else if('function'==typeof e)c=e;else{if('object'!=typeof e||null===e)throw Error('shape should be a store or object with stores');u=effector.createStoreObject(e)}const i=null!==(r=null===(s=u)||void 0===s?void 0:s.shortName)&&void 0!==r?r:'Unknown',p=effector.createEvent(i+".View mounted"),l=effector.createEvent(i+".View unmounted");return a=o=class extends n.Component{constructor(...t){super(...t),this._unsubscribe=null,this._hasUnmounted=0,this.store='function'==typeof e?c(this.props):u,this.state={currentState:this.store.getState()}}componentDidMount(){p({props:this.props,state:this.store.getState()}),this.subscribe()}componentWillUnmount(){l({props:this.props,state:this.store.getState()}),this.unsubscribe(),this._hasUnmounted=1}render(){return t(this.props,this.state.currentState)}subscribe(){this._unsubscribe=this.store.watch(e=>{this._hasUnmounted||this.setState(t=>e===t.currentState?null:{currentState:e})})}unsubscribe(){'function'==typeof this._unsubscribe&&this._unsubscribe(),this._unsubscribe=null}},o.displayName=i+".View",o.mounted=p,o.unmounted=l,a}function t(t){return e(t,({children:e},t)=>e(t))}function r(e){if(!effector.is.store(e))throw Error('expect useStore argument to be a store');const t=n.useReducer(c,void 0,e.getState)[1];return a(()=>e.watch(t),[e]),e.getState()}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}function o(e,r){const o=t(e),a=e=>n.createElement(o,null,t=>n.createElement(r,s({},e,t)));return a.displayName="Connect("+(r.displayName||r.name||'Unknown')+")",a}Object.defineProperty(exports,'__esModule',{value:1});var n=require('react'),effector=require('effector');const a='undefined'!=typeof window?n.useLayoutEffect:n.useEffect,c=(e,t)=>t,{store:u}=effector.createDomain('Gate');exports.connect=e=>t=>o(t,e),exports.createComponent=e,exports.createContextComponent=function(e,r,s){var o,a;const c=t(e);return a=o=class extends n.Component{constructor(...e){super(...e),this.renderProp=e=>s(this.props,e,this.context)}render(){return n.createElement(c,null,this.renderProp)}},o.contextType=r,a},exports.createGate=function e(t="gate",r={}){const s=u(0),o=u(r),{set:a}=effector.createApi(o,{set:(e,t)=>t}),{open:c,close:i,destructor:p}=effector.createApi(s,{open:()=>l.predicate()&&1,close:()=>0,destructor:()=>0});class l extends n.PureComponent{static childGate(r="Subgate"){const s=e(t+"/"+r);s.predicate=()=>l.status.getState();let o=0,n=0;return s.open.watch(()=>{n||(o=1)}),s.close.watch(()=>{n||(o=0)}),l.status.watch(e=>{n=1,o&&e&&!s.status.getState()&&s.open(),n=0}),l.close.watch(()=>{n=1,s.close(),n=0}),l.destructor.watch(()=>s.destructor()),s}componentDidMount(){l.open()}componentWillUnmount(){l.close()}render(){return l.set(this.props),null}}l.predicate=()=>1,l.displayName="Gate:"+t,l.isOpen=0,l.current=o.getState(),l.open=c,l.close=i,l.status=s,l.state=o,l.set=a,l.destructor=p,l.isTerminated=0;const h=s.watch(e=>l.isOpen=e),d=o.watch(e=>l.current=e);s.map(e=>{e||(l.current=r)}),o.reset(i);const f=p.watch(()=>{l.isTerminated=1}),m=p.watch(()=>{m(),h(),d(),f(),l.status.off(l.open),l.status.off(l.close),l.status.off(l.destructor),l.state.off(l.set)});return l},exports.createReactState=o,exports.createStoreConsumer=t,exports.unstable_createStoreProvider=function(e){var t,r;return r=t=class extends n.Component{constructor(...e){super(...e),this.state={currentValue:null}}static getDerivedStateFromProps(t){return e.setState(t.value),{currentValue:t.value}}render(){return this.props.children}},t.displayName=e.shortName+".Provider",t.defaultProps={children:null},r},exports.useGate=(e,t={})=>{n.useEffect(()=>(e.open(),()=>e.close()),[e]),e.set(t)},exports.useStore=r,exports.useStoreMap=({store:e,keys:t,fn:s})=>{if(!effector.is.store(e))throw Error('useStoreMap expects a store');if(!Array.isArray(t))throw Error('useStoreMap expects an array as keys');if('function'!=typeof s)throw Error('useStoreMap expects a function');const o=n.useMemo(()=>effector.createStore(s(e.getState(),t)).on(e,(e,r)=>s(r,t)),t),c=r(o);return a(()=>()=>{o.off(e),effector.clearNode(o,{deep:1})},t),c};
//# sourceMappingURL=effector-react.cjs.js.map
