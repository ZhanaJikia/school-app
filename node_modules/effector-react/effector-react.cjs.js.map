{"version":3,"file":"effector-react.cjs.js","sources":["node_modules/effector-react/createComponent.js","node_modules/effector-react/createStoreConsumer.js","node_modules/effector-react/useStore.js","node_modules/effector-react/createReactState.js","node_modules/effector-react/createGate.js","node_modules/effector-react/connect.js","node_modules/effector-react/createContextComponent.js","node_modules/effector-react/createStoreProvider.js"],"sourcesContent":["//@flow\n\nimport * as React from 'react'\nimport {type Store, is, createStoreObject, createEvent} from 'effector'\nimport type {StoreView} from './index.h'\n\ntype Unsubscribe = () => void\n\nexport function createComponent<Props: {}, State>(\n  shape:\n    | Store<State>\n    | {+[key: string]: Store<any> | any}\n    | ((props: Props) => Store<State>),\n  renderProp: (props: Props, state: State) => React.Node,\n): StoreView<State, Props> {\n  let storeFn: (props: Props) => Store<any>\n  let store: Store<any>\n  if (is.store(shape)) {\n    store = (shape: any)\n  } else if (typeof shape === 'function') {\n    storeFn = shape\n  } else {\n    if (typeof shape === 'object' && shape !== null) {\n      store = createStoreObject(shape)\n    } else throw Error('shape should be a store or object with stores')\n  }\n  const storeName = store?.shortName ?? 'Unknown'\n  const mounted = createEvent(`${storeName}.View mounted`)\n  const unmounted = createEvent(`${storeName}.View unmounted`)\n  return class RenderComponent extends React.Component<\n    Props,\n    {currentState: State},\n  > {\n    static displayName = `${storeName}.View`\n    static mounted = mounted\n    static unmounted = unmounted\n    _unsubscribe: Unsubscribe | null = null\n    _hasUnmounted: boolean = false\n    store = typeof shape === 'function' ? storeFn(this.props) : store\n    state = {currentState: this.store.getState()}\n    componentDidMount() {\n      mounted({props: this.props, state: this.store.getState()})\n      this.subscribe()\n    }\n    componentWillUnmount() {\n      unmounted({props: this.props, state: this.store.getState()})\n      this.unsubscribe()\n      this._hasUnmounted = true\n    }\n    render() {\n      return renderProp(this.props, this.state.currentState)\n    }\n    subscribe() {\n      this._unsubscribe = this.store.watch((state: State) => {\n        if (this._hasUnmounted) {\n          return\n        }\n\n        this.setState(prevState => {\n          if (state === prevState.currentState) {\n            return null\n          }\n          return {currentState: state}\n        })\n      })\n    }\n    unsubscribe() {\n      if (typeof this._unsubscribe === 'function') {\n        this._unsubscribe()\n      }\n\n      this._unsubscribe = null\n    }\n  }\n}\n","//@flow\n\nimport * as React from 'react'\n\nimport type {Store} from 'effector'\n\nimport type {StoreConsumer} from './index.h'\nimport {createComponent} from './createComponent'\n\nexport function createStoreConsumer<State>(\n  store: Store<State>,\n): StoreConsumer<State> {\n  return createComponent(store, ({children}, state) => children(state))\n}\n","//@flow\n\nimport {type Store, is, clearNode, createStore} from 'effector'\nimport {useEffect, useLayoutEffect, useReducer, useMemo} from 'react'\n\nconst useIsomorphicLayoutEffect =\n  typeof window !== 'undefined' ? useLayoutEffect : useEffect\n\nconst stateReducer = (_: any, payload: any) => payload\n\nexport function useStore<State>(store: Store<State>): State {\n  if (!is.store(store)) throw Error('expect useStore argument to be a store')\n  const dispatch = useReducer(stateReducer, undefined, store.getState)[1]\n  useIsomorphicLayoutEffect(() => store.watch(dispatch), [store])\n  return store.getState()\n}\n\nexport function useStoreMap<State, Result, Keys: $ReadOnlyArray<any>>({\n  store,\n  keys,\n  fn,\n}: {|\n  +store: Store<State>,\n  +keys: Keys,\n  fn(state: State, keys: Keys): Result,\n|}): Result {\n  if (!is.store(store)) throw Error('useStoreMap expects a store')\n  if (!Array.isArray(keys)) throw Error('useStoreMap expects an array as keys')\n  if (typeof fn !== 'function') throw Error('useStoreMap expects a function')\n  const result: Store<Result> = useMemo(\n    () =>\n      createStore(fn(store.getState(), keys)).on(store, (_, state) =>\n        fn(state, keys),\n      ),\n    keys,\n  )\n  const state = useStore(result)\n  useIsomorphicLayoutEffect(\n    () => () => {\n      result.off(store)\n      clearNode(result, {deep: true})\n    },\n    keys,\n  )\n  return state\n}\n","//@flow\n\nimport * as React from 'react'\nimport {createStoreConsumer} from './createStoreConsumer'\n\nimport type {Store} from 'effector'\n\nexport function createReactState<State: Object, Com: React.ComponentType<*>>(\n  store: Store<State>,\n  Component: Com,\n): React.ComponentType<$Exact<$Diff<React.ElementConfig<Com>, State>>> {\n  const Store = createStoreConsumer(store)\n  const ConnectedComponent = props => (\n    <Store>{state => <Component {...props} {...state} />}</Store>\n  )\n  const wrappedComponentName =\n    Component.displayName || Component.name || 'Unknown'\n  ConnectedComponent.displayName = `Connect(${wrappedComponentName})`\n  return ConnectedComponent\n}\n","//@flow\n\nimport * as React from 'react'\nimport {useEffect} from 'react'\nimport {createDomain, createApi, type Store, type Event} from 'effector'\n\nconst {store: createStore} = createDomain('Gate')\n\nexport type Gate<Props = {||}> = Class<React.Component<Props>> &\n  interface {\n    isOpen: boolean,\n    isTerminated: boolean,\n    open: Event<void>,\n    close: Event<void>,\n    status: Store<boolean>,\n    destructor: Event<void>,\n    current: Props,\n    state: Store<Props>,\n    set: Event<Props>,\n    childGate<Next>(childName?: string): Gate<Next>,\n  }\n\nexport function useGate<Props>(\n  GateComponent: Gate<Props>,\n  props?: Props = ({}: any),\n) {\n  useEffect(() => {\n    GateComponent.open()\n    return () => GateComponent.close()\n  }, [GateComponent])\n  GateComponent.set(props)\n}\n\nexport function createGate<Props>(\n  name: string = 'gate',\n  defaultState: Props = ({}: any),\n): Gate<Props> {\n  const status = createStore(false)\n  const state: Store<Props> = createStore(defaultState)\n  const {set} = createApi(state, {\n    set: (_, state) => state,\n  })\n\n  const {open, close, destructor} = createApi(status, {\n    open: () => GateComponent.predicate() && true,\n    close: () => false,\n    destructor: () => false,\n  })\n\n  class GateComponent extends React.PureComponent<Props> {\n    static predicate = () => true\n\n    static displayName = `Gate:${name}`\n    static isOpen = false\n    static current = state.getState()\n    static open = open\n    static close = close\n    static status = status\n    static state = state\n    static set = set\n    static destructor = destructor\n    static isTerminated = false\n    static childGate<Next>(childName: string = 'Subgate'): Gate<Next> {\n      const gate = createGate(`${name}/${childName}`)\n      ;(gate: any).predicate = () => GateComponent.status.getState()\n      let isOpen = false\n      let isFeedback = false\n      gate.open.watch(() => {\n        if (!isFeedback) isOpen = true\n      })\n      gate.close.watch(() => {\n        if (!isFeedback) isOpen = false\n      })\n\n      GateComponent.status.watch(status => {\n        isFeedback = true\n        if (isOpen && status && !gate.status.getState()) {\n          gate.open()\n        }\n        isFeedback = false\n      })\n      GateComponent.close.watch(() => {\n        isFeedback = true\n        gate.close()\n        isFeedback = false\n      })\n      GateComponent.destructor.watch(() => gate.destructor())\n      return gate\n    }\n\n    componentDidMount() {\n      GateComponent.open()\n    }\n    componentWillUnmount() {\n      GateComponent.close()\n    }\n    render() {\n      GateComponent.set(this.props)\n      return null\n    }\n  }\n  const unwatch = status.watch(status => (GateComponent.isOpen = status))\n  const unwatch2 = state.watch(current => (GateComponent.current = current))\n  const unwatch3 = status.map(status => {\n    if (!status) GateComponent.current = defaultState\n  })\n  state.reset(close)\n\n  const setTerminated = destructor.watch(() => {\n    GateComponent.isTerminated = true\n  })\n  const unstate = () => {\n    GateComponent.status.off(GateComponent.open)\n    GateComponent.status.off(GateComponent.close)\n    GateComponent.status.off(GateComponent.destructor)\n  }\n\n  const undestruct = destructor.watch(() => {\n    undestruct()\n    unwatch()\n    unwatch2()\n    setTerminated()\n    unstate()\n    GateComponent.state.off(GateComponent.set)\n  })\n  return GateComponent\n}\n","//@flow\n\nimport * as React from 'react'\n\nimport type {Store} from 'effector'\nimport {createReactState} from './createReactState'\n\nexport function connect<State: Object, Com: React.ComponentType<*>>(\n  Component: Com,\n): (\n  store: Store<State>,\n) => React.ComponentType<$Exact<$Diff<React.ElementConfig<Com>, State>>> {\n  return store => createReactState(store, Component)\n}\n","//@flow\n\nimport * as React from 'react'\nimport type {Store} from 'effector'\nimport {createStoreConsumer} from './createStoreConsumer'\n\nexport function createContextComponent<Props: {}, State, Context>(\n  store: Store<State>,\n  context: React.Context<Context>,\n  renderProp: (props: Props, state: State, context: Context) => React.Node,\n): React.ComponentType<Props> {\n  const Consumer = createStoreConsumer(store)\n  return class RenderComponent extends React.Component<Props> {\n    static contextType = context\n    renderProp = (state: State) => renderProp(this.props, state, this.context)\n    render() {\n      return <Consumer>{this.renderProp}</Consumer>\n    }\n  }\n}\n","//@flow\n\nimport * as React from 'react'\n\nimport type {Store} from 'effector'\n\nimport type {StoreProvider} from './index.h'\n\nexport function unstable_createStoreProvider<State>(\n  store: Store<State>,\n): StoreProvider<State> {\n  return class StoreProvider extends React.Component<\n    {\n      value: State,\n      children: React.Node,\n      ...\n    },\n    {|+currentValue: React.Node|},\n  > {\n    static displayName = `${store.shortName}.Provider`\n    static defaultProps = {\n      children: null,\n    }\n    state = {\n      currentValue: null,\n    }\n    static getDerivedStateFromProps(props) {\n      //$off\n      store.setState(props.value)\n      return {\n        currentValue: props.value,\n      }\n    }\n    render() {\n      return this.props.children\n    }\n  }\n}\n"],"names":["createComponent","shape","renderProp","storeFn","store","is","Error","createStoreObject","storeName","_store","shortName","mounted","createEvent","unmounted","React","_unsubscribe","_hasUnmounted","this","props","state","currentState","getState","componentDidMount","subscribe","componentWillUnmount","unsubscribe","render","watch","setState","prevState","displayName","createStoreConsumer","children","useStore","dispatch","useReducer","stateReducer","undefined","useIsomorphicLayoutEffect","createReactState","Component","Store","ConnectedComponent","React.createElement","name","window","useLayoutEffect","useEffect","_","payload","createStore","createDomain","context","Consumer","contextType","createGate","defaultState","status","set","createApi","open","close","destructor","GateComponent","predicate","childName","gate","isOpen","isFeedback","current","isTerminated","unwatch","unwatch2","map","reset","setTerminated","undestruct","off","currentValue","value","defaultProps","keys","fn","Array","isArray","result","useMemo","on","clearNode","deep"],"mappings":"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"}