return e=this,t=function(e,t,effector){function r(e,r){var s,n,o,c;let a,u;if(effector.is.store(e))u=e;else if('function'==typeof e)a=e;else{if('object'!=typeof e||null===e)throw Error('shape should be a store or object with stores');u=effector.createStoreObject(e)}const i=null!==(s=null===(n=u)||void 0===n?void 0:n.shortName)&&void 0!==s?s:'Unknown',p=effector.createEvent(i+".View mounted"),l=effector.createEvent(i+".View unmounted");return c=o=class extends t.Component{constructor(...t){super(...t),this._unsubscribe=null,this._hasUnmounted=0,this.store='function'==typeof e?a(this.props):u,this.state={currentState:this.store.getState()}}componentDidMount(){p({props:this.props,state:this.store.getState()}),this.subscribe()}componentWillUnmount(){l({props:this.props,state:this.store.getState()}),this.unsubscribe(),this._hasUnmounted=1}render(){return r(this.props,this.state.currentState)}subscribe(){this._unsubscribe=this.store.watch(e=>{this._hasUnmounted||this.setState(t=>e===t.currentState?null:{currentState:e})})}unsubscribe(){'function'==typeof this._unsubscribe&&this._unsubscribe(),this._unsubscribe=null}},o.displayName=i+".View",o.mounted=p,o.unmounted=l,c}function s(e){return r(e,({children:e},t)=>e(t))}function n(e){if(!effector.is.store(e))throw Error('expect useStore argument to be a store');const r=t.useReducer(u,void 0,e.getState)[1];return a(()=>e.watch(r),[e]),e.getState()}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}function c(e,r){const n=s(e),c=e=>t.createElement(n,null,s=>t.createElement(r,o({},e,s)));return c.displayName="Connect("+(r.displayName||r.name||'Unknown')+")",c}const a='undefined'!=typeof window?t.useLayoutEffect:t.useEffect,u=(e,t)=>t,{store:i}=effector.createDomain('Gate');e.connect=e=>t=>c(t,e),e.createComponent=r,e.createContextComponent=function(e,r,n){var o,c;const a=s(e);return c=o=class extends t.Component{constructor(...e){super(...e),this.renderProp=e=>n(this.props,e,this.context)}render(){return t.createElement(a,null,this.renderProp)}},o.contextType=r,c},e.createGate=function e(r="gate",s={}){const n=i(0),o=i(s),{set:c}=effector.createApi(o,{set:(e,t)=>t}),{open:a,close:u,destructor:p}=effector.createApi(n,{open:()=>l.predicate()&&1,close:()=>0,destructor:()=>0});class l extends t.PureComponent{static childGate(t="Subgate"){const s=e(r+"/"+t);s.predicate=()=>l.status.getState();let n=0,o=0;return s.open.watch(()=>{o||(n=1)}),s.close.watch(()=>{o||(n=0)}),l.status.watch(e=>{o=1,n&&e&&!s.status.getState()&&s.open(),o=0}),l.close.watch(()=>{o=1,s.close(),o=0}),l.destructor.watch(()=>s.destructor()),s}componentDidMount(){l.open()}componentWillUnmount(){l.close()}render(){return l.set(this.props),null}}l.predicate=()=>1,l.displayName="Gate:"+r,l.isOpen=0,l.current=o.getState(),l.open=a,l.close=u,l.status=n,l.state=o,l.set=c,l.destructor=p,l.isTerminated=0;const f=n.watch(e=>l.isOpen=e),d=o.watch(e=>l.current=e);n.map(e=>{e||(l.current=s)}),o.reset(u);const h=p.watch(()=>{l.isTerminated=1}),m=p.watch(()=>{m(),f(),d(),h(),l.status.off(l.open),l.status.off(l.close),l.status.off(l.destructor),l.state.off(l.set)});return l},e.createReactState=c,e.createStoreConsumer=s,e.unstable_createStoreProvider=function(e){var r,s;return s=r=class extends t.Component{constructor(...e){super(...e),this.state={currentValue:null}}static getDerivedStateFromProps(t){return e.setState(t.value),{currentValue:t.value}}render(){return this.props.children}},r.displayName=e.shortName+".Provider",r.defaultProps={children:null},s},e.useGate=(e,r={})=>{t.useEffect(()=>(e.open(),()=>e.close()),[e]),e.set(r)},e.useStore=n,e.useStoreMap=({store:e,keys:r,fn:s})=>{if(!effector.is.store(e))throw Error('useStoreMap expects a store');if(!Array.isArray(r))throw Error('useStoreMap expects an array as keys');if('function'!=typeof s)throw Error('useStoreMap expects a function');const o=t.useMemo(()=>effector.createStore(s(e.getState(),r)).on(e,(e,t)=>s(t,r)),r),c=n(o);return a(()=>()=>{o.off(e),effector.clearNode(o,{deep:1})},r),c},Object.defineProperty(e,'__esModule',{value:1})},void('object'==typeof exports&&'undefined'!=typeof module?t(exports,require('react'),require('effector')):'function'==typeof define&&define.amd?define(['exports','react','effector'],t):t((e=e||self).effectorReact={},e.React,e.effector));var e,t;
//# sourceMappingURL=effector-react.umd.js.map
