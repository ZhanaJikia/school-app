function e({node:e,child:t=[],from:n=[],scope:r={},meta:o={}}){return{from:n.map(z),seq:e,next:t.map(z),meta:o,scope:r}}function t(e){return e.compositeName?e.compositeName.fullName:e.domainName?e.domainName.fullName:e.id}function n(e){let n=0;const r=Object.values(e),o=xe-1,a=r.length-1;let s='combine(';for(const e of r){const r=n===o||a===n?'':', ';if(ge(e)||ve(e)||ye(e)?s+=t(e)+r:s+=e.toString()+r,n+=1,''===r)break}return s+')'}function r(e,t,n){this.shortName=e,this.fullName=t,this.path=n}function o(e,t){let n,o;const a=e;return void 0===t?(n=0===e.length?[]:[e],o=e):0===e.length?(n=t.path,o=t.fullName):(n=t.path.concat([e]),o=0===t.fullName.length?e:t.fullName+'/'+e),new r(a,o,n)}function a(e){return e(this)}function s(){const e=this.indexOf();-1!==e&&(this.splice(e,1),this.indexOf=we,this.splice=ke)}function i({name:n,parent:r,config:s={}}){const c=Oe(),l=n||c,u=o(l,r),f=u.fullName,p=e({node:[G.emit({fullName:f})]}),d=(e,...t)=>d.create(e,f,t);return d.getType=(()=>f),d.create=(e=>(ie(d,e),e)),d.kind=F,d[q]=(()=>d),d.id=c,d.watch=((e,n)=>je(e,{scope:{trigger:e,handler:n},node:[pe,G.run({fn:(e,{trigger:n,handler:r})=>r(e,t(n))})]})).bind(null,d),d.map=((e,t)=>{const n=i({name:e.shortName+' → *',parent:e.domainName});return je(e,{child:[n],scope:{handler:t},node:[G.compute({fn:(e,{handler:t})=>t(e)})]}),n}).bind(null,d),d.filter=function(e,t){const n=i({name:e.shortName+' →? *',parent:e.domainName});let r,o;return'object'==typeof t?(o={fn:t.fn},r=[G.filter({fn:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=(()=>e.toString()),t}((e,{fn:t})=>t(e))})]):(o={fn:t},r=[G.compute({fn:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=(()=>e.toString()),t}((e,{fn:t})=>t(e))}),G.filter({fn:e=>void 0!==e})]),je(e,{scope:o,child:[n],node:r}),n}.bind(null,d),d.prepend=((e,t)=>{const n=i({name:'* → '+e.shortName,parent:e.domainName});return je(n,{child:[e],scope:{handler:t},node:[G.compute({fn:(e,{handler:t})=>t(e)})]}),n}).bind(null,d),d.subscribe=((e,t)=>e.watch(e=>t.next(e))).bind(null,d),d.thru=a.bind(d),d.graphite=p,d.shortName=l,d.domainName=r,d.compositeName=u,d.defaultConfig=s,d}function c(e={}){const t='createStore: Second argument should be plain object, but you passed %s.';me('object'==typeof e&&null!==e,t,e),void 0!==(null==e?void 0:e.ɔ)&&me('object'==typeof e.ɔ&&null!==e.ɔ,t,e.ɔ);const n=Object.assign({},e,'object'==typeof e.ɔ?e.ɔ:{});return delete n.ɔ,n}function l(e,t){const n='object'==typeof e?Object.assign({},c(t),e):c(t);return{config:n,name:'object'==typeof e||void 0===e?n.name:e}}function u(e,t={}){const{config:n,name:r}=l(e,t);return i({name:r,config:n})}function f(){}function p(){}function d(e){return V(e.plainState)}function m(e,t){const n=e.subscribers.get(t);void 0!==n&&(n(),e.subscribers.delete(t))}function h(e,n,r){const o=n,a=e.subscribers.get(o);return a&&a(),e.subscribers.set(o,je(o,{scope:{handler:r,state:e.plainState,trigger:o},child:[e],node:[G.compute({fn(e,{handler:n,state:r,trigger:o}){const a=n(V(r),e,t(o));if(void 0!==a)return W(r,a)}})]})),this}function b(e,n,r){const o='watch requires function handler';switch(r&&(null==n?void 0:n.kind)){case'store':case'event':case'effect':return C('function'==typeof r,o),n.watch(o=>r(d(e),o,t(n)));default:return C('function'==typeof n,o),g(e,n)}}function g(e,t){C('function'==typeof t,'Expected the listener to be a function');let n='Got initial error',r=d(e);f(e,'subscribe');try{t(r),n='Initial'}catch(e){console.error(e)}return p(n),je(e,{node:[pe,G.run({fn(n){let o=null;if(f(e,'subscribe'),n!==r){r=n;try{t(n)}catch(e){console.error(e),o='Got error'}p(o)}else p(o)}})]})}function v(t){const{currentState:n,config:r,parent:s}=t,{name:i}=r,c=_(n),l=i||c.id,y=n,N=o(l,s),S=u('update '+l),x={graphite:e({scope:{state:c,oldState:n},node:[G.filter({fn:e=>void 0!==e}),G.update({store:c}),G.filter({fn:(e,t)=>e===t.oldState?0:(t.oldState=e,1)})]}),kind:D,id:c.id,shortName:l,domainName:s,defaultConfig:r,defaultState:y,plainState:c,subscribers:new Map,compositeName:N},w={compositeName:x.compositeName,graphite:x.graphite,kind:D,id:c.id,shortName:l,domainName:s,setState:(e,t)=>{const n=d(x),r='function'==typeof t?t(n,e):e;ie(w,r)},off:m.bind(null,x),watch:b.bind(null,x),updates:S,subscribe:g.bind(null,x),getState:d.bind(null,x),stateRef:c};return w.defaultConfig=r,w.reset=function(e,...t){for(const n of t)h.call(this,e,n,()=>e.defaultState);return this}.bind(w,x),w.on=h.bind(w,x),w.defaultState=y,w.map=function(e,t,n){let r;f(e,'map');let o='Got initial error';try{const a=e.getState();void 0!==a&&(r=t(a,n)),o='Initial'}catch(e){console.error(e)}p(o);const a=this({config:{name:e.shortName+' → *'},currentState:r,parent:e.domainName});return je(e,{child:[a],scope:{store:e,handler:t,state:a.stateRef},node:[G.compute({fn(e,{state:t,store:n,handler:r}){f(n,'map');let o,a='Got error';try{o=r(e,V(t)),a=null}catch(e){console.error(e)}return p(a),o}}),fe]}),a}.bind(v,w),w.thru=a.bind(w),w.dispatch=(e=>e).bind(null),w[q]=function(e){const t={subscribe:t=>(C('object'==typeof t&&null!==t,'Expected the observer to be an object.'),g(e,e=>{t.next&&t.next(e)}))};return t[q]=function(){return this},t}.bind(null,x),Ee({from:w,to:S}),w}function y(e,t={}){return C(void 0!==e,"createStore: First argument can't be undefined, use null instead."),v({currentState:e,config:c(t)})}function N(e,t){const n=Array.isArray(e)?Me(e,e=>e.slice(),[]):Me(e,e=>Object.assign({},e),{});return t?n.map(t):n}function S(e){const t={};for(const n in e){const r=e[n];t[n]=ge(r)?r:v({currentState:r,config:{name:n}})}return t}function x(e,t){const n=v({currentState:t,parent:e.domainName,config:{name:e.shortName}});return n.on(e.done,(e,{result:t})=>t),n}function w(e,t){const n=v({currentState:t,parent:e.domainName,config:{name:e.shortName}});return n.on(e,(e,t)=>t),n}function k(...e){let t,n,r;C(e.length>0,'at least one argument required');{const r=e[e.length-1];'function'==typeof r?(n=e.slice(0,-1),t=r):n=e}e:{if(1===n.length){const e=n[0];if(!ge(e)){r=e;break e}}r=n,t&&(t=He(t))}return N(r,t)}function j(){const e=new Promise((e,t)=>{this.rs=e,this.rj=t});e.anyway=(()=>(me(0,'.anyway is deprecated, use .finally'),e.then(()=>{},()=>{}))),this.req=e}function E({name:e,parent:t,config:n}){const{handler:r}=n,o=i({name:e,parent:t,config:n}),a=o.create,s=i({name:o.shortName+' done',parent:t,config:n}),c=i({name:o.shortName+' fail',parent:t,config:n});s.graphite.seq.push(Be),c.graphite.seq.push(Be);let l=r||function(){return me(0,'no thunk used in %s',this.getType()),Promise.resolve()}.bind(o);o.done=s,o.fail=c,o.use=(e=>(l=e,o));const u=()=>l;return o.use.getCurrent=u,o.kind=M,o.graphite.scope={done:s,fail:c,getHandler:u},o.graphite.seq.push(G.compute({fn:e=>'object'==typeof e&&null!==e&&'ɔ'in e?e.ɔ:{params:e,req:{rs(e){},rj(e){}}}}),G.run({fn:({params:e,req:t},{getHandler:n,done:r,fail:o})=>(((e,t,n,r)=>{let o,a,s=0;try{a=e(t)}catch(e){s=1,o=e}s?r(o):'object'!=typeof a||null===a||'function'!=typeof a.then?n(a):a.then(n,r)})(n(),e,function(e){const{event:t,params:n,handler:r}=this;ce(t,{handler:r,toHandler:e,result:{params:n,result:e}})}.bind({event:r,params:e,handler:t.rs}),function(e){const{event:t,params:n,handler:r}=this;ce(t,{handler:r,toHandler:e,result:{params:n,error:e}})}.bind({event:o,params:e,handler:t.rj})),e)})),o.create=((e,t,n)=>{const r=new j;return a({"ɔ":{params:e,req:r}},o.getType(),n),r.req}),o.pending=y(Boolean(0)).on(o,()=>Boolean(1)).reset(s).reset(c),o}Object.defineProperty(exports,'__esModule',{value:1});var O,q=(O=require('symbol-observable'))&&'object'==typeof O&&'default'in O?O.default:O;const I='production'!==process.env.NODE_ENV;var C=I?function e(t,n,...r){if(!t){const t=Error();Error.captureStackTrace&&Error.captureStackTrace(t,e),t.name='Invariant Violation';let o=0;throw t.message=n.replace(/%s/g,()=>r[o++]),t}}:e=>{if(!e)throw Error('Minified exception occurred')};const D='store',F='event',M='effect';var H=Object.freeze({store:D,event:F,effect:M,domain:"domain"});const R=()=>{let e=0;return()=>(++e).toString(36)},T=R(),B=(e,t)=>({id:T(),type:e,group:'cmd',data:t}),G={barrier:({barrierID:e,priority:t="barrier"})=>B('barrier',{barrierID:e,priority:t}),compute:B.bind(null,'compute'),emit:B.bind(null,'emit'),filter:B.bind(null,'filter'),run:B.bind(null,'run'),tap:B.bind(null,'tap'),update:B.bind(null,'update')},P=(e,{deep:t}={})=>{const n=z(e);t&&n.next.forEach(e=>P(e,{deep:t})),n.from.forEach(e=>{const t=e.next.indexOf(n);-1!==t&&e.next.splice(t,1)}),n.from.length=0,n.next.length=0,n.seq.length=0,n.scope=null},z=e=>e.graphite||e,A=R(),_=e=>({id:A(),current:e}),V=({current:e})=>e,W=(e,t)=>e.current=t,K=R(),U=e=>{switch(e){case'child':return 0;case'pure':return 1;case'barrier':return 2;case'sampler':return 3;case'effect':return 4;default:return-1}};class J{constructor(e,t){this.value={current:e},this.parent=t}}class L{constructor(e,t,n,r){this.value=e,this.rank=t,this.left=n,this.right=r}}const Q=e=>e?X(e.left,e.right):null,X=(e,t)=>{let n,r,o,a,s,i,c;for(;;){var l,u;if(n=t,!(r=e))return n;if(!n)return r;if(a=r.left,!Z(o=r.value,n.value))return s=X(r.right,n),(i=(null===(l=a)||void 0===l?void 0:l.rank)||0)>=(c=(null===(u=s)||void 0===u?void 0:u.rank)||0)?new L(o,c+1,a,s):new L(o,i+1,s,a);t=r,e=n}};class Y{constructor(e){this.isChanged=1,this.isFailed=0,this.scope=e}}const Z=(e,t)=>e.type===t.type?e.id>t.id:U(e.type)>U(t.type);let $=0,ee=null;const te=new Set,ne=e=>{ee=((e,t)=>X(new L(e,1,null,null),t))(e,ee)},re=({step:e,firstIndex:t,scope:n,resetStop:r},o)=>{const a=new Y(e.scope);for(let r=t;r<e.seq.length&&!o.stop;r++){const s=e.seq[r];if(r===t)'barrier'===s.type&&te.delete(s.data.barrierID);else switch(s.type){case'run':return void ne({step:e,firstIndex:r,scope:n,resetStop:0,type:'effect',id:++$});case'barrier':{const t=s.data.barrierID;return void(te.has(t)||(te.add(t),ne({step:e,firstIndex:r,scope:n,resetStop:0,type:s.data.priority,id:++$})))}}(0,le[s.type])(a,s.data,n.value),o.stop=a.isFailed||!a.isChanged}if(!o.stop)for(let t=0;t<e.next.length;t++){const r=new J(V(n.value),n);ne({step:e.next[t],firstIndex:0,scope:r,resetStop:1,type:'child',id:++$})}r&&(o.stop=0)};let oe=0;const ae=(e,t)=>{ne({step:z(e),firstIndex:0,scope:new J(t,null),resetStop:0,type:'pure',id:++$})},se=()=>{const e=oe;oe=1;const t={stop:0};let n;for(;ee;)n=ee.value,ee=Q(ee),re(n,t);oe=e},ie=(e,t)=>{ae(e,t),se()},ce=(e,t)=>{ae(e,t),oe||se()},le={barrier(e,t,n){e.isFailed=0,e.isChanged=1},emit(e,t,n){},filter(e,t,n){const r=ue({arg:V(n),val:e.scope,fn:t.fn});e.isChanged=!!r.result},run(e,t,n){const r=ue({arg:V(n),val:e.scope,fn:t.fn});e.isFailed=r.err,W(n,r.result)},update(e,t,n){W(t.store,V(n))},compute(e,t,n){const r=ue({arg:V(n),val:e.scope,fn:t.fn});e.isFailed=r.err,W(n,r.result)},tap(e,t,n){const r=ue({arg:V(n),val:e.scope,fn:t.fn});e.isFailed=r.err}},ue=({fn:e,arg:t,val:n})=>{const r={err:0,result:null};try{r.result=e(t,n)}catch(e){console.error(e),r.err=1}return r},fe=G.filter({fn:(e,{state:t})=>e!==V(t)&&void 0!==e}),pe=G.compute({fn:e=>e});var de=Object.freeze({filterChanged:fe,noop:pe}),me=I?(e,t,...n)=>{e||console.error('Warning: '+t,...n)}:()=>{};const he=e=>('function'==typeof e||'object'==typeof e&&null!==e)&&'kind'in e,be=e=>t=>he(t)&&t.kind===e,ge=be(D),ve=be(F),ye=be(M),Ne=be("domain");var Se=Object.freeze({unit:he,store:ge,event:ve,effect:ye,domain:Ne});const xe=25,we=()=>-1,ke=()=>[],je=(t,n)=>Ee({from:t,to:e(n)}),Ee=e=>{const t=z(e.from),n=z(e.to);return t.next.push(n),(e=>{const t=e.parent.next,n={indexOf:t.indexOf.bind(t,e.child),splice:t.splice.bind(t)},r=s.bind(n);return r.unsubscribe=s.bind(n),r})({child:n,parent:t})},Oe=R();let qe=null,Ie=null;if(I){const e='☄',n='undefined'!=typeof performance&&'function'==typeof performance.mark&&'function'==typeof performance.clearMarks&&'function'==typeof performance.measure&&'function'==typeof performance.clearMeasures;function Ce(t){return e+" "+t}const r=(t,n)=>e+" "+t+(n?" Warning: "+n:'');function De(e,t){return e+"."+t}function Fe(e,t){return e+" (#"+t+")"}const o=()=>{null!==qe&&null!==Ie&&((e,n)=>{const r=t(e),o=e.id;var a;a=Fe(De(r,n),o),performance.clearMarks(Ce(a))})(Ie,qe),Ie=null,qe=null};f=((e,r)=>{n&&(o(),((e,n)=>{const r=t(e),o=e.id;return a=Fe(De(r,n),o),performance.mark(Ce(a)),1;var a})(e,r)&&(Ie=e,qe=r))}),p=(e=>{n&&(null!==qe&&null!==Ie&&((e,n,o)=>{const a=t(e),s=e.id,i=De(a,n);((e,t,n)=>{const o=Ce(t),a=r(e,n);try{performance.measure(a,o)}catch(e){}performance.clearMarks(o),performance.clearMeasures(a)})(i,Fe(i,s),o)})(Ie,qe,e),qe=null,Ie=null)})}const Me=(e,t,r)=>{const o=[G.filter({fn:(e,{target:t,key:n})=>e!==V(t)[n]&&void 0!==e}),G.tap({fn(e,{isFresh:t,target:n,clone:r}){V(t)||(W(n,r(V(n))),W(t,1))}}),G.tap({fn(e,{target:t,key:n}){V(t)[n]=e}}),G.barrier({barrierID:K()}),G.compute({fn:(e,{isFresh:t,target:n})=>(W(t,0),V(n))})],a=t(r),s=v({currentState:a,config:{name:n(e)}}),i=_(0);for(const n in e){const c=e[n];ge(c)?(r[n]=c.defaultState,a[n]=c.getState(),je(c,{scope:{key:n,clone:t,target:s.stateRef,isFresh:i},node:o,child:[s]})):a[n]=r[n]=c}return s.defaultShape=e,s.defaultState=r,s},He=e=>t=>e(...t),Re=(e,t,n,r,o)=>(je(t,{scope:{state:e.stateRef,fn:n},child:[o],node:[!r&&pe,!r&&G.barrier({barrierID:K(),priority:'sampler'}),G.compute({fn:n?(e,{state:t,fn:n})=>n(V(t),e):(e,{state:t})=>V(t)})].filter(Boolean)}),o),Te=e=>he(e)?e:N(e),Be=G.run({fn:({handler:e,toHandler:t,result:n})=>(e(t),n)});class Ge{constructor(){this.events=new Set,this.effects=new Set,this.storages=new Set,this.domains=new Set}}const Pe=R();exports.Kind=H,exports.blocks=de,exports.clearNode=P,exports.combine=k,exports.createApi=((e,t)=>{const n={};for(const r in t){const o=t[r],a=n[r]=u(r);e.on(a,o)}return n}),exports.createDomain=((e,t={})=>{const{config:n,name:r}=l(e,t);return function e({name:t,config:n={},parent:r,parentHooks:a}){const s=Pe(),l=o(t||'',r),u=new Ge,f=((e,t,n)=>{let r;return(r=n?(e=>({event:e.event.prepend(e=>e),effect:e.effect.prepend(e=>e),store:e.store.prepend(e=>e),domain:e.domain.prepend(e=>e)}))(n):(e=>({event:i({name:e.fullName+" event hook",parent:e}),effect:i({name:e.fullName+" effect hook",parent:e}),store:i({name:e.fullName+" store hook",parent:e}),domain:i({parent:e})}))(t)).domain.watch(t=>{e.domains.add(t)}),r.event.watch(t=>{e.events.add(t)}),r.store.watch(t=>{e.storages.add(t)}),r.effect.watch(t=>{e.effects.add(t)}),r})(u,l,a);return{compositeName:l,id:s,defaultConfig:n,getType:()=>l.fullName,onCreateEvent:e=>(u.events.forEach(e),f.event.watch(e)),onCreateEffect:e=>(u.effects.forEach(e),f.effect.watch(e)),onCreateStore:e=>(u.storages.forEach(e),f.store.watch(e)),onCreateDomain:e=>(u.domains.forEach(e),f.domain.watch(e)),event(e,t={}){const n=c(t),r=i({name:e,parent:l,config:n});return f.event(r),r},effect(e,t={}){const n=c(t),r=E({name:e,domainName:l.fullName,parent:l,config:n});return f.effect(r),r},domain(t,n={}){const r=c(n),o=e({name:t,parent:l,parentHooks:f,config:r});return f.domain(o),o},store(e,t={}){const n=c(t),r=v({currentState:e,parent:l,config:n});return f.store(r),r},kind:"domain"}}({name:void 0===r?'':r,config:n})}),exports.createEffect=((e,t)=>{const{config:n,name:r}=l(e,t);return E({name:r,domainName:'',config:n})}),exports.createEvent=u,exports.createNode=e,exports.createStore=y,exports.createStoreObject=k,exports.extract=((e,t)=>{let n;return N(n=t('defaultShape'in e?e.defaultShape:e.defaultState))}),exports.forward=Ee,exports.fromObservable=(e=>{C('function'==typeof e||'object'==typeof e&&null!==e,'expect observable to be object or function');const t=q in e?e[q]():e;C('subscribe'in t,'expect observable to have .subscribe');const n=u(),r=P.bind(null,n,{});return t.subscribe({next:n,error:r,complete:r}),n}),exports.invariant=C,exports.is=Se,exports.isDomain=Ne,exports.isEffect=ye,exports.isEvent=ve,exports.isStore=ge,exports.isUnit=he,exports.launch=ie,exports.restore=((e,t)=>ge(e)?e:ve(e)?w(e,t):ye(e)?x(e,t):S(e)),exports.restoreEffect=x,exports.restoreEvent=w,exports.restoreObject=S,exports.sample=((e,t,n,r=0)=>{let o;void 0===t&&'source'in e&&(t=e.clock||e.sampler,n=e.fn,r=e.greedy,o=e.target,e=e.source),void 0===t&&(t=e);const a=Te(e),s=Te(t);return'boolean'==typeof n&&(r=n,n=void 0),(ge(a)?ge(s)?(e,t,n,r,o)=>{const a=V(e.stateRef);return Re(e,t,n,r,o||v({currentState:n?n(a,V(t.stateRef)):a,config:{name:e.shortName},parent:e.domainName}))}:(e,t,n,r,o)=>Re(e,t,n,r,o||i({name:e.shortName,parent:e.domainName})):(e,t,n,r,o)=>{o=o||i({name:e.shortName,parent:e.domainName});const a=_(0),s=_(),c=_();return je(e,{scope:{hasSource:a},node:[G.update({store:s}),G.tap({fn(e,{hasSource:t}){W(t,1)}})]}),je(t,{scope:{sourceState:s,clockState:c,hasSource:a,fn:n},child:[o],node:[G.update({store:c}),G.filter({fn:(e,{hasSource:t})=>V(t)}),!r&&G.barrier({barrierID:K(),priority:'sampler'}),G.compute({fn:n?(e,{sourceState:t,clockState:n,fn:r})=>r(V(t),V(n)):(e,{sourceState:t})=>V(t)})].filter(Boolean)}),o})(a,s,n,r,o)}),exports.setStoreName=((e,t)=>{const n=o(t,e.domainName);e.shortName=t,e.compositeName?(e.compositeName.path=n.path,e.compositeName.shortName=n.shortName,e.compositeName.fullName=n.fullName):e.compositeName=n}),exports.step=G,exports.version="19.1.0",exports.warning=me,exports.withProps=((e,t)=>n=>t(e.getState(),n));
//# sourceMappingURL=effector.cjs.js.map
