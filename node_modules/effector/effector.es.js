function e({node:e,child:t=[],from:n=[],scope:r={},meta:o={}}){return{from:n.map(X),seq:e,next:t.map(X),meta:o,scope:r}}function t(e){return e.compositeName?e.compositeName.fullName:e.domainName?e.domainName.fullName:e.id}function n(e){let n=0;const r=Object.values(e),o=Fe-1,a=r.length-1;let i='combine(';for(const e of r){const r=n===o||a===n?'':', ';if(Ie(e)||qe(e)||Ce(e)?i+=t(e)+r:i+=e.toString()+r,n+=1,''===r)break}return i+')'}function r(e,t,n){this.shortName=e,this.fullName=t,this.path=n}function o(e,t){let n,o;const a=e;return void 0===t?(n=0===e.length?[]:[e],o=e):0===e.length?(n=t.path,o=t.fullName):(n=t.path.concat([e]),o=0===t.fullName.length?e:t.fullName+'/'+e),new r(a,o,n)}function a(e){return e(this)}function i(){const e=this.indexOf();-1!==e&&(this.splice(e,1),this.indexOf=He,this.splice=Me)}function s({name:n,parent:r,config:i={}}){const c=Be(),u=n||c,l=o(u,r),f=l.fullName,d=e({node:[L.emit({fullName:f})]}),p=(e,...t)=>p.create(e,f,t);return p.getType=(()=>f),p.create=(e=>(ge(p,e),e)),p.kind=P,p[T]=(()=>p),p.id=c,p.watch=((e,n)=>Re(e,{scope:{trigger:e,handler:n},node:[we,L.run({fn:(e,{trigger:n,handler:r})=>r(e,t(n))})]})).bind(null,p),p.map=((e,t)=>{const n=s({name:e.shortName+' → *',parent:e.domainName});return Re(e,{child:[n],scope:{handler:t},node:[L.compute({fn:(e,{handler:t})=>t(e)})]}),n}).bind(null,p),p.filter=function(e,t){const n=s({name:e.shortName+' →? *',parent:e.domainName});let r,o;return'object'==typeof t?(o={fn:t.fn},r=[L.filter({fn:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=(()=>e.toString()),t}((e,{fn:t})=>t(e))})]):(o={fn:t},r=[L.compute({fn:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=(()=>e.toString()),t}((e,{fn:t})=>t(e))}),L.filter({fn:e=>void 0!==e})]),Re(e,{scope:o,child:[n],node:r}),n}.bind(null,p),p.prepend=((e,t)=>{const n=s({name:'* → '+e.shortName,parent:e.domainName});return Re(n,{child:[e],scope:{handler:t},node:[L.compute({fn:(e,{handler:t})=>t(e)})]}),n}).bind(null,p),p.subscribe=((e,t)=>e.watch(e=>t.next(e))).bind(null,p),p.thru=a.bind(p),p.graphite=d,p.shortName=u,p.domainName=r,p.compositeName=l,p.defaultConfig=i,p}function c(e={}){const t='createStore: Second argument should be plain object, but you passed %s.';xe('object'==typeof e&&null!==e,t,e),void 0!==(null==e?void 0:e.ɔ)&&xe('object'==typeof e.ɔ&&null!==e.ɔ,t,e.ɔ);const n=Object.assign({},e,'object'==typeof e.ɔ?e.ɔ:{});return delete n.ɔ,n}function u(e,t){const n='object'==typeof e?Object.assign({},c(t),e):c(t);return{config:n,name:'object'==typeof e||void 0===e?n.name:e}}function l(e,t={}){const{config:n,name:r}=u(e,t);return s({name:r,config:n})}function f(e){z('function'==typeof e||'object'==typeof e&&null!==e,'expect observable to be object or function');const t=T in e?e[T]():e;z('subscribe'in t,'expect observable to have .subscribe');const n=l(),r=Q.bind(null,n,{});return t.subscribe({next:n,error:r,complete:r}),n}function d(){}function p(){}function m(e){return $(e.plainState)}function h(e,t){const n=e.subscribers.get(t);void 0!==n&&(n(),e.subscribers.delete(t))}function b(e,n,r){const o=n,a=e.subscribers.get(o);return a&&a(),e.subscribers.set(o,Re(o,{scope:{handler:r,state:e.plainState,trigger:o},child:[e],node:[L.compute({fn(e,{handler:n,state:r,trigger:o}){const a=n($(r),e,t(o));if(void 0!==a)return ee(r,a)}})]})),this}function g(e,n,r){const o='watch requires function handler';switch(r&&(null==n?void 0:n.kind)){case'store':case'event':case'effect':return z('function'==typeof r,o),n.watch(o=>r(m(e),o,t(n)));default:return z('function'==typeof n,o),v(e,n)}}function v(e,t){z('function'==typeof t,'Expected the listener to be a function');let n='Got initial error',r=m(e);d(e,'subscribe');try{t(r),n='Initial'}catch(e){console.error(e)}return p(n),Re(e,{node:[we,L.run({fn(n){let o=null;if(d(e,'subscribe'),n!==r){r=n;try{t(n)}catch(e){console.error(e),o='Got error'}p(o)}else p(o)}})]})}function y(t){const{currentState:n,config:r,parent:i}=t,{name:s}=r,c=Z(n),u=s||c.id,f=n,N=o(u,i),S=l('update '+u),w={graphite:e({scope:{state:c,oldState:n},node:[L.filter({fn:e=>void 0!==e}),L.update({store:c}),L.filter({fn:(e,t)=>e===t.oldState?0:(t.oldState=e,1)})]}),kind:A,id:c.id,shortName:u,domainName:i,defaultConfig:r,defaultState:f,plainState:c,subscribers:new Map,compositeName:N},k={compositeName:w.compositeName,graphite:w.graphite,kind:A,id:c.id,shortName:u,domainName:i,setState:(e,t)=>{const n=m(w),r='function'==typeof t?t(n,e):e;ge(k,r)},off:h.bind(null,w),watch:g.bind(null,w),updates:S,subscribe:v.bind(null,w),getState:m.bind(null,w),stateRef:c};return k.defaultConfig=r,k.reset=function(e,...t){for(const n of t)b.call(this,e,n,()=>e.defaultState);return this}.bind(k,w),k.on=b.bind(k,w),k.defaultState=f,k.map=function(e,t,n){let r;d(e,'map');let o='Got initial error';try{const a=e.getState();void 0!==a&&(r=t(a,n)),o='Initial'}catch(e){console.error(e)}p(o);const a=this({config:{name:e.shortName+' → *'},currentState:r,parent:e.domainName});return Re(e,{child:[a],scope:{store:e,handler:t,state:a.stateRef},node:[L.compute({fn(e,{state:t,store:n,handler:r}){d(n,'map');let o,a='Got error';try{o=r(e,$(t)),a=null}catch(e){console.error(e)}return p(a),o}}),Se]}),a}.bind(y,k),k.thru=a.bind(k),k.dispatch=(e=>e).bind(null),k[T]=function(e){const t={subscribe:t=>(z('object'==typeof t&&null!==t,'Expected the observer to be an object.'),v(e,e=>{t.next&&t.next(e)}))};return t[T]=function(){return this},t}.bind(null,w),Te({from:k,to:S}),k}function N(e,t={}){return z(void 0!==e,"createStore: First argument can't be undefined, use null instead."),y({currentState:e,config:c(t)})}function S(e,t){const n=o(t,e.domainName);e.shortName=t,e.compositeName?(e.compositeName.path=n.path,e.compositeName.shortName=n.shortName,e.compositeName.fullName=n.fullName):e.compositeName=n}function w(e,t){const n=Array.isArray(e)?We(e,e=>e.slice(),[]):We(e,e=>Object.assign({},e),{});return t?n.map(t):n}function k(e,t){let n;return w(n=t('defaultShape'in e?e.defaultShape:e.defaultState))}function x(e,t){const n={};for(const r in t){const o=t[r],a=n[r]=l(r);e.on(a,o)}return n}function j(e){const t={};for(const n in e){const r=e[n];t[n]=Ie(r)?r:y({currentState:r,config:{name:n}})}return t}function E(e,t){const n=y({currentState:t,parent:e.domainName,config:{name:e.shortName}});return n.on(e.done,(e,{result:t})=>t),n}function I(e,t){const n=y({currentState:t,parent:e.domainName,config:{name:e.shortName}});return n.on(e,(e,t)=>t),n}function q(e,t){return Ie(e)?e:qe(e)?I(e,t):Ce(e)?E(e,t):j(e)}function C(e,t){return n=>t(e.getState(),n)}function O(...e){let t,n,r;z(e.length>0,'at least one argument required');{const r=e[e.length-1];'function'==typeof r?(n=e.slice(0,-1),t=r):n=e}e:{if(1===n.length){const e=n[0];if(!Ie(e)){r=e;break e}}r=n,t&&(t=Ke(t))}return w(r,t)}function D(e,t,n,r=0){let o;void 0===t&&'source'in e&&(t=e.clock||e.sampler,n=e.fn,r=e.greedy,o=e.target,e=e.source),void 0===t&&(t=e);const a=Qe(e),i=Qe(t);return'boolean'==typeof n&&(r=n,n=void 0),(Ie(a)?Ie(i)?Je:_e:Le)(a,i,n,r,o)}function F(){const e=new Promise((e,t)=>{this.rs=e,this.rj=t});e.anyway=(()=>(xe(0,'.anyway is deprecated, use .finally'),e.then(()=>{},()=>{}))),this.req=e}function H({name:e,parent:t,config:n}){const{handler:r}=n,o=s({name:e,parent:t,config:n}),a=o.create,i=s({name:o.shortName+' done',parent:t,config:n}),c=s({name:o.shortName+' fail',parent:t,config:n});i.graphite.seq.push(Xe),c.graphite.seq.push(Xe);let u=r||function(){return xe(0,'no thunk used in %s',this.getType()),Promise.resolve()}.bind(o);o.done=i,o.fail=c,o.use=(e=>(u=e,o));const l=()=>u;return o.use.getCurrent=l,o.kind=V,o.graphite.scope={done:i,fail:c,getHandler:l},o.graphite.seq.push(L.compute({fn:e=>'object'==typeof e&&null!==e&&'ɔ'in e?e.ɔ:{params:e,req:{rs(e){},rj(e){}}}}),L.run({fn:({params:e,req:t},{getHandler:n,done:r,fail:o})=>(((e,t,n,r)=>{let o,a,i=0;try{a=e(t)}catch(e){i=1,o=e}i?r(o):'object'!=typeof a||null===a||'function'!=typeof a.then?n(a):a.then(n,r)})(n(),e,function(e){const{event:t,params:n,handler:r}=this;ve(t,{handler:r,toHandler:e,result:{params:n,result:e}})}.bind({event:r,params:e,handler:t.rs}),function(e){const{event:t,params:n,handler:r}=this;ve(t,{handler:r,toHandler:e,result:{params:n,error:e}})}.bind({event:o,params:e,handler:t.rj})),e)})),o.create=((e,t,n)=>{const r=new F;return a({"ɔ":{params:e,req:r}},o.getType(),n),r.req}),o.pending=N(Boolean(0)).on(o,()=>Boolean(1)).reset(i).reset(c),o}function M(e,t){const{config:n,name:r}=u(e,t);return H({name:r,domainName:'',config:n})}function R(e,t={}){const{config:n,name:r}=u(e,t);return function e({name:t,config:n={},parent:r,parentHooks:a}){const i=et(),u=o(t||'',r),l=new Ye,f=((e,t,n)=>{let r;return(r=n?$e(n):Ze(t)).domain.watch(t=>{e.domains.add(t)}),r.event.watch(t=>{e.events.add(t)}),r.store.watch(t=>{e.storages.add(t)}),r.effect.watch(t=>{e.effects.add(t)}),r})(l,u,a);return{compositeName:u,id:i,defaultConfig:n,getType:()=>u.fullName,onCreateEvent:e=>(l.events.forEach(e),f.event.watch(e)),onCreateEffect:e=>(l.effects.forEach(e),f.effect.watch(e)),onCreateStore:e=>(l.storages.forEach(e),f.store.watch(e)),onCreateDomain:e=>(l.domains.forEach(e),f.domain.watch(e)),event(e,t={}){const n=c(t),r=s({name:e,parent:u,config:n});return f.event(r),r},effect(e,t={}){const n=c(t),r=H({name:e,domainName:u.fullName,parent:u,config:n});return f.effect(r),r},domain(t,n={}){const r=c(n),o=e({name:t,parent:u,parentHooks:f,config:r});return f.domain(o),o},store(e,t={}){const n=c(t),r=y({currentState:e,parent:u,config:n});return f.store(r),r},kind:W}}({name:void 0===r?'':r,config:n})}import T from'symbol-observable';const B="19.1.0",G='production'!==process.env.NODE_ENV;var z=G?function e(t,n,...r){if(!t){const t=Error();Error.captureStackTrace&&Error.captureStackTrace(t,e),t.name='Invariant Violation';let o=0;throw t.message=n.replace(/%s/g,()=>r[o++]),t}}:e=>{if(!e)throw Error('Minified exception occurred')};const A='store',P='event',V='effect',W='domain';var K=Object.freeze({store:A,event:P,effect:V,domain:W});const U=()=>{let e=0;return()=>(++e).toString(36)},_=U(),J=(e,t)=>({id:_(),type:e,group:'cmd',data:t}),L={barrier:({barrierID:e,priority:t="barrier"})=>J('barrier',{barrierID:e,priority:t}),compute:J.bind(null,'compute'),emit:J.bind(null,'emit'),filter:J.bind(null,'filter'),run:J.bind(null,'run'),tap:J.bind(null,'tap'),update:J.bind(null,'update')},Q=(e,{deep:t}={})=>{const n=X(e);t&&n.next.forEach(e=>Q(e,{deep:t})),n.from.forEach(e=>{const t=e.next.indexOf(n);-1!==t&&e.next.splice(t,1)}),n.from.length=0,n.next.length=0,n.seq.length=0,n.scope=null},X=e=>e.graphite||e,Y=U(),Z=e=>({id:Y(),current:e}),$=({current:e})=>e,ee=(e,t)=>e.current=t,te=U(),ne=e=>{switch(e){case'child':return 0;case'pure':return 1;case'barrier':return 2;case'sampler':return 3;case'effect':return 4;default:return-1}};class re{constructor(e,t){this.value={current:e},this.parent=t}}class oe{constructor(e,t,n,r){this.value=e,this.rank=t,this.left=n,this.right=r}}const ae=e=>e?ie(e.left,e.right):null,ie=(e,t)=>{let n,r,o,a,i,s,c;for(;;){var u,l;if(n=t,!(r=e))return n;if(!n)return r;if(a=r.left,!ce(o=r.value,n.value))return i=ie(r.right,n),(s=(null===(u=a)||void 0===u?void 0:u.rank)||0)>=(c=(null===(l=i)||void 0===l?void 0:l.rank)||0)?new oe(o,c+1,a,i):new oe(o,s+1,i,a);t=r,e=n}};class se{constructor(e){this.isChanged=1,this.isFailed=0,this.scope=e}}const ce=(e,t)=>e.type===t.type?e.id>t.id:ne(e.type)>ne(t.type);let ue=0,le=null;const fe=new Set,de=e=>{le=((e,t)=>ie(new oe(e,1,null,null),t))(e,le)},pe=({step:e,firstIndex:t,scope:n,resetStop:r},o)=>{const a=new se(e.scope);for(let r=t;r<e.seq.length&&!o.stop;r++){const i=e.seq[r];if(r===t)'barrier'===i.type&&fe.delete(i.data.barrierID);else switch(i.type){case'run':return void de({step:e,firstIndex:r,scope:n,resetStop:0,type:'effect',id:++ue});case'barrier':{const t=i.data.barrierID;return void(fe.has(t)||(fe.add(t),de({step:e,firstIndex:r,scope:n,resetStop:0,type:i.data.priority,id:++ue})))}}(0,ye[i.type])(a,i.data,n.value),o.stop=a.isFailed||!a.isChanged}if(!o.stop)for(let t=0;t<e.next.length;t++){const r=new re($(n.value),n);de({step:e.next[t],firstIndex:0,scope:r,resetStop:1,type:'child',id:++ue})}r&&(o.stop=0)};let me=0;const he=(e,t)=>{de({step:X(e),firstIndex:0,scope:new re(t,null),resetStop:0,type:'pure',id:++ue})},be=()=>{const e=me;me=1;const t={stop:0};let n;for(;le;)n=le.value,le=ae(le),pe(n,t);me=e},ge=(e,t)=>{he(e,t),be()},ve=(e,t)=>{he(e,t),me||be()},ye={barrier(e,t,n){e.isFailed=0,e.isChanged=1},emit(e,t,n){},filter(e,t,n){const r=Ne({arg:$(n),val:e.scope,fn:t.fn});e.isChanged=!!r.result},run(e,t,n){const r=Ne({arg:$(n),val:e.scope,fn:t.fn});e.isFailed=r.err,ee(n,r.result)},update(e,t,n){ee(t.store,$(n))},compute(e,t,n){const r=Ne({arg:$(n),val:e.scope,fn:t.fn});e.isFailed=r.err,ee(n,r.result)},tap(e,t,n){const r=Ne({arg:$(n),val:e.scope,fn:t.fn});e.isFailed=r.err}},Ne=({fn:e,arg:t,val:n})=>{const r={err:0,result:null};try{r.result=e(t,n)}catch(e){console.error(e),r.err=1}return r},Se=L.filter({fn:(e,{state:t})=>e!==$(t)&&void 0!==e}),we=L.compute({fn:e=>e});var ke=Object.freeze({filterChanged:Se,noop:we}),xe=G?(e,t,...n)=>{e||console.error('Warning: '+t,...n)}:()=>{};const je=e=>('function'==typeof e||'object'==typeof e&&null!==e)&&'kind'in e,Ee=e=>t=>je(t)&&t.kind===e,Ie=Ee(A),qe=Ee(P),Ce=Ee(V),Oe=Ee(W);var De=Object.freeze({unit:je,store:Ie,event:qe,effect:Ce,domain:Oe});const Fe=25,He=()=>-1,Me=()=>[],Re=(t,n)=>Te({from:t,to:e(n)}),Te=e=>{const t=X(e.from),n=X(e.to);return t.next.push(n),(e=>{const t=e.parent.next,n={indexOf:t.indexOf.bind(t,e.child),splice:t.splice.bind(t)},r=i.bind(n);return r.unsubscribe=i.bind(n),r})({child:n,parent:t})},Be=U();let Ge=null,ze=null;if(G){const e='☄',n='undefined'!=typeof performance&&'function'==typeof performance.mark&&'function'==typeof performance.clearMarks&&'function'==typeof performance.measure&&'function'==typeof performance.clearMeasures;function Ae(t){return e+" "+t}const r=(t,n)=>e+" "+t+(n?" Warning: "+n:'');function Pe(e,t){return e+"."+t}function Ve(e,t){return e+" (#"+t+")"}const o=()=>{null!==Ge&&null!==ze&&((e,n)=>{const r=t(e),o=e.id;var a;a=Ve(Pe(r,n),o),performance.clearMarks(Ae(a))})(ze,Ge),ze=null,Ge=null};d=((e,r)=>{n&&(o(),((e,n)=>{const r=t(e),o=e.id;return a=Ve(Pe(r,n),o),performance.mark(Ae(a)),1;var a})(e,r)&&(ze=e,Ge=r))}),p=(e=>{n&&(null!==Ge&&null!==ze&&((e,n,o)=>{const a=t(e),i=e.id,s=Pe(a,n);((e,t,n)=>{const o=Ae(t),a=r(e,n);try{performance.measure(a,o)}catch(e){}performance.clearMarks(o),performance.clearMeasures(a)})(s,Ve(s,i),o)})(ze,Ge,e),Ge=null,ze=null)})}const We=(e,t,r)=>{const o=[L.filter({fn:(e,{target:t,key:n})=>e!==$(t)[n]&&void 0!==e}),L.tap({fn(e,{isFresh:t,target:n,clone:r}){$(t)||(ee(n,r($(n))),ee(t,1))}}),L.tap({fn(e,{target:t,key:n}){$(t)[n]=e}}),L.barrier({barrierID:te()}),L.compute({fn:(e,{isFresh:t,target:n})=>(ee(t,0),$(n))})],a=t(r),i=y({currentState:a,config:{name:n(e)}}),s=Z(0);for(const n in e){const c=e[n];Ie(c)?(r[n]=c.defaultState,a[n]=c.getState(),Re(c,{scope:{key:n,clone:t,target:i.stateRef,isFresh:s},node:o,child:[i]})):a[n]=r[n]=c}return i.defaultShape=e,i.defaultState=r,i},Ke=e=>t=>e(...t),Ue=(e,t,n,r,o)=>(Re(t,{scope:{state:e.stateRef,fn:n},child:[o],node:[!r&&we,!r&&L.barrier({barrierID:te(),priority:'sampler'}),L.compute({fn:n?(e,{state:t,fn:n})=>n($(t),e):(e,{state:t})=>$(t)})].filter(Boolean)}),o),_e=(e,t,n,r,o)=>Ue(e,t,n,r,o||s({name:e.shortName,parent:e.domainName})),Je=(e,t,n,r,o)=>{const a=$(e.stateRef);return Ue(e,t,n,r,o||y({currentState:n?n(a,$(t.stateRef)):a,config:{name:e.shortName},parent:e.domainName}))},Le=(e,t,n,r,o)=>{o=o||s({name:e.shortName,parent:e.domainName});const a=Z(0),i=Z(),c=Z();return Re(e,{scope:{hasSource:a},node:[L.update({store:i}),L.tap({fn(e,{hasSource:t}){ee(t,1)}})]}),Re(t,{scope:{sourceState:i,clockState:c,hasSource:a,fn:n},child:[o],node:[L.update({store:c}),L.filter({fn:(e,{hasSource:t})=>$(t)}),!r&&L.barrier({barrierID:te(),priority:'sampler'}),L.compute({fn:n?(e,{sourceState:t,clockState:n,fn:r})=>r($(t),$(n)):(e,{sourceState:t})=>$(t)})].filter(Boolean)}),o},Qe=e=>je(e)?e:w(e),Xe=L.run({fn:({handler:e,toHandler:t,result:n})=>(e(t),n)});class Ye{constructor(){this.events=new Set,this.effects=new Set,this.storages=new Set,this.domains=new Set}}const Ze=e=>({event:s({name:e.fullName+" event hook",parent:e}),effect:s({name:e.fullName+" effect hook",parent:e}),store:s({name:e.fullName+" store hook",parent:e}),domain:s({parent:e})}),$e=e=>({event:e.event.prepend(e=>e),effect:e.effect.prepend(e=>e),store:e.store.prepend(e=>e),domain:e.domain.prepend(e=>e)}),et=U();export{K as Kind,ke as blocks,Q as clearNode,O as combine,x as createApi,R as createDomain,M as createEffect,l as createEvent,e as createNode,N as createStore,O as createStoreObject,k as extract,Te as forward,f as fromObservable,z as invariant,De as is,Oe as isDomain,Ce as isEffect,qe as isEvent,Ie as isStore,je as isUnit,ge as launch,q as restore,E as restoreEffect,I as restoreEvent,j as restoreObject,D as sample,S as setStoreName,L as step,B as version,xe as warning,C as withProps};
//# sourceMappingURL=effector.es.js.map
